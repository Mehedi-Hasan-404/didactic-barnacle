name: Build Checkbox Demo APK

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]

jobs:
  build:
    name: Create Project & Build APK
    runs-on: ubuntu-latest

    steps:
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Create project structure
        run: |
          mkdir -p CheckboxDemo/app/src/main/java/com/checkboxdemo
          mkdir -p CheckboxDemo/app/src/main/res/layout
          mkdir -p CheckboxDemo/app/src/main/res/values
          mkdir -p CheckboxDemo/app/src/main/res/drawable
          mkdir -p CheckboxDemo/gradle/wrapper

      - name: Write gradle.properties
        run: |
          cat > CheckboxDemo/gradle.properties << 'EOF'
          android.useAndroidX=true
          android.enableJetifier=true
          org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
          EOF

      - name: Write settings.gradle.kts
        run: |
          cat > CheckboxDemo/settings.gradle.kts << 'EOF'
          pluginManagement {
              repositories {
                  google()
                  mavenCentral()
                  gradlePluginPortal()
              }
          }
          dependencyResolutionManagement {
              repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
              repositories {
                  google()
                  mavenCentral()
              }
          }
          rootProject.name = "CheckboxDemo"
          include(":app")
          EOF

      - name: Write root build.gradle.kts
        run: |
          cat > CheckboxDemo/build.gradle.kts << 'EOF'
          plugins {
              id("com.android.application") version "8.3.2" apply false
              id("org.jetbrains.kotlin.android") version "1.9.23" apply false
          }
          EOF

      - name: Write app/build.gradle.kts
        run: |
          cat > CheckboxDemo/app/build.gradle.kts << 'EOF'
          plugins {
              id("com.android.application")
              id("org.jetbrains.kotlin.android")
          }

          android {
              namespace = "com.checkboxdemo"
              compileSdk = 34

              defaultConfig {
                  applicationId = "com.checkboxdemo"
                  minSdk = 24
                  targetSdk = 34
                  versionCode = 1
                  versionName = "1.0"
              }

              buildTypes {
                  debug {
                      isDebuggable = true
                  }
              }

              compileOptions {
                  sourceCompatibility = JavaVersion.VERSION_17
                  targetCompatibility = JavaVersion.VERSION_17
              }

              kotlinOptions {
                  jvmTarget = "17"
              }

              buildFeatures {
                  viewBinding = true
              }
          }

          dependencies {
              implementation("androidx.core:core-ktx:1.13.1")
              implementation("androidx.appcompat:appcompat:1.7.0")
              implementation("com.google.android.material:material:1.11.0")
              implementation("androidx.constraintlayout:constraintlayout:2.1.4")
              implementation("androidx.recyclerview:recyclerview:1.3.2")
          }
          EOF

      - name: Write AndroidManifest.xml
        run: |
          cat > CheckboxDemo/app/src/main/AndroidManifest.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <manifest xmlns:android="http://schemas.android.com/apk/res/android">
              <application
                  android:allowBackup="true"
                  android:label="Video Settings Demo"
                  android:theme="@style/Theme.CheckboxDemo"
                  android:supportsRtl="true">
                  <activity
                      android:name=".MainActivity"
                      android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN" />
                          <category android:name="android.intent.category.LAUNCHER" />
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

      - name: Write themes.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/values/themes.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <resources>
              <style name="Theme.CheckboxDemo" parent="Theme.MaterialComponents.DayNight.NoActionBar">
                  <item name="colorPrimary">#EF4444</item>
                  <item name="colorPrimaryVariant">#DC2626</item>
                  <item name="colorOnPrimary">#FFFFFF</item>
                  <item name="colorSecondary">#EF4444</item>
                  <item name="colorOnSecondary">#FFFFFF</item>
                  <item name="android:colorBackground">#000000</item>
                  <item name="colorSurface">#1F1F1F</item>
                  <item name="colorOnSurface">#FFFFFF</item>
                  <item name="android:statusBarColor">#000000</item>
                  <item name="android:windowLightStatusBar">false</item>
              </style>

              <style name="TabTextStyle" parent="TextAppearance.Design.Tab">
                  <item name="android:textSize">14sp</item>
                  <item name="android:textStyle">bold</item>
                  <item name="android:textAllCaps">true</item>
              </style>
          </resources>
          EOF

      - name: Write strings.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/values/strings.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <resources>
              <string name="app_name">Video Settings Demo</string>
          </resources>
          EOF

      - name: Write ripple_item_bg.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/drawable/ripple_item_bg.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <ripple xmlns:android="http://schemas.android.com/apk/res/android"
              android:color="#33FFFFFF">
              <item android:id="@android:id/mask">
                  <shape android:shape="rectangle">
                      <solid android:color="@android:color/white" />
                  </shape>
              </item>
          </ripple>
          EOF

      - name: Write dialog_player_settings.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/layout/dialog_player_settings.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <androidx.constraintlayout.widget.ConstraintLayout
              xmlns:android="http://schemas.android.com/apk/res/android"
              xmlns:app="http://schemas.android.com/apk/res-auto"
              android:layout_width="match_parent"
              android:layout_height="match_parent">

              <com.google.android.material.card.MaterialCardView
                  android:id="@+id/dialogCard"
                  android:layout_width="0dp"
                  android:layout_height="wrap_content"
                  android:layout_marginStart="24dp"
                  android:layout_marginEnd="24dp"
                  android:layout_marginTop="32dp"
                  android:layout_marginBottom="32dp"
                  app:layout_constraintTop_toTopOf="parent"
                  app:layout_constraintBottom_toBottomOf="parent"
                  app:layout_constraintStart_toStartOf="parent"
                  app:layout_constraintEnd_toEndOf="parent"
                  app:layout_constraintVertical_bias="0.5"
                  app:cardCornerRadius="28dp"
                  app:cardElevation="6dp"
                  app:cardBackgroundColor="#1F1F1F">

                  <LinearLayout
                      android:layout_width="match_parent"
                      android:layout_height="wrap_content"
                      android:orientation="vertical">

                      <RelativeLayout
                          android:layout_width="match_parent"
                          android:layout_height="56dp"
                          android:paddingStart="20dp"
                          android:paddingEnd="16dp"
                          android:background="#1F1F1F">

                          <TextView
                              android:id="@+id/tvTitle"
                              android:layout_width="wrap_content"
                              android:layout_height="wrap_content"
                              android:layout_centerVertical="true"
                              android:text="Video Settings"
                              android:textColor="@android:color/white"
                              android:textSize="18sp"
                              android:textStyle="bold" />

                          <ImageButton
                              android:id="@+id/btnClose"
                              android:layout_width="40dp"
                              android:layout_height="40dp"
                              android:layout_alignParentEnd="true"
                              android:layout_centerVertical="true"
                              android:background="?attr/selectableItemBackgroundBorderless"
                              android:src="@android:drawable/ic_menu_close_clear_cancel"
                              android:tint="@android:color/white"
                              android:contentDescription="Close" />
                      </RelativeLayout>

                      <com.google.android.material.tabs.TabLayout
                          android:id="@+id/tabLayout"
                          android:layout_width="match_parent"
                          android:layout_height="48dp"
                          android:background="#252525"
                          app:tabIndicatorColor="#EF4444"
                          app:tabIndicatorHeight="2dp"
                          app:tabSelectedTextColor="#EF4444"
                          app:tabTextColor="#999999"
                          app:tabMode="fixed"
                          app:tabGravity="fill"
                          app:tabTextAppearance="@style/TabTextStyle" />

                      <androidx.recyclerview.widget.RecyclerView
                          android:id="@+id/recyclerView"
                          android:layout_width="match_parent"
                          android:layout_height="200dp"
                          android:paddingTop="4dp"
                          android:paddingBottom="4dp"
                          android:clipToPadding="false"
                          android:scrollbars="vertical" />

                      <View
                          android:layout_width="match_parent"
                          android:layout_height="1dp"
                          android:background="#333333" />

                      <LinearLayout
                          android:layout_width="match_parent"
                          android:layout_height="wrap_content"
                          android:orientation="horizontal"
                          android:gravity="end"
                          android:padding="12dp"
                          android:background="#1F1F1F">

                          <com.google.android.material.button.MaterialButton
                              android:id="@+id/btnCancel"
                              style="@style/Widget.MaterialComponents.Button.TextButton"
                              android:layout_width="wrap_content"
                              android:layout_height="40dp"
                              android:text="CANCEL"
                              android:textColor="#999999"
                              android:textSize="14sp"
                              android:layout_marginEnd="8dp" />

                          <com.google.android.material.button.MaterialButton
                              android:id="@+id/btnApply"
                              style="@style/Widget.MaterialComponents.Button.TextButton"
                              android:layout_width="wrap_content"
                              android:layout_height="40dp"
                              android:text="APPLY"
                              android:textColor="#EF4444"
                              android:textSize="14sp" />
                      </LinearLayout>

                  </LinearLayout>
              </com.google.android.material.card.MaterialCardView>

          </androidx.constraintlayout.widget.ConstraintLayout>
          EOF

      - name: Write item_track_option.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/layout/item_track_option.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <LinearLayout
              xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="wrap_content"
              android:orientation="horizontal"
              android:paddingStart="20dp"
              android:paddingEnd="12dp"
              android:paddingTop="6dp"
              android:paddingBottom="6dp"
              android:background="@drawable/ripple_item_bg"
              android:clickable="true"
              android:focusable="true"
              android:gravity="center_vertical"
              android:minHeight="48dp">

              <LinearLayout
                  android:layout_width="0dp"
                  android:layout_height="wrap_content"
                  android:layout_weight="1"
                  android:orientation="vertical">

                  <TextView
                      android:id="@+id/tvPrimary"
                      android:layout_width="wrap_content"
                      android:layout_height="wrap_content"
                      android:textColor="@android:color/white"
                      android:textSize="12sp"
                      android:textStyle="bold"
                      android:fontFamily="sans-serif-medium" />

                  <TextView
                      android:id="@+id/tvSecondary"
                      android:layout_width="wrap_content"
                      android:layout_height="wrap_content"
                      android:textColor="#999999"
                      android:textSize="11sp"
                      android:layout_marginTop="1dp" />

              </LinearLayout>

              <RadioButton
                  android:id="@+id/radioToggle"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:layout_marginStart="8dp"
                  android:clickable="false"
                  android:focusable="false"
                  android:buttonTint="#EF4444" />

              <com.google.android.material.checkbox.MaterialCheckBox
                  android:id="@+id/checkToggle"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:layout_marginStart="8dp"
                  android:clickable="false"
                  android:focusable="false"
                  android:visibility="gone" />

          </LinearLayout>
          EOF

      - name: Write activity_main.xml
        run: |
          cat > CheckboxDemo/app/src/main/res/layout/activity_main.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <FrameLayout
              xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:background="#000000">

              <com.google.android.material.button.MaterialButton
                  android:id="@+id/btnOpenDialog"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:layout_gravity="center"
                  android:text="Open Video Settings"
                  android:textColor="#FFFFFF"
                  android:backgroundTint="#EF4444"
                  android:textSize="16sp" />

          </FrameLayout>
          EOF

      - name: Write TrackItem.kt
        run: |
          cat > CheckboxDemo/app/src/main/java/com/checkboxdemo/TrackItem.kt << 'EOF'
          package com.checkboxdemo

          data class TrackItem(
              val primary: String,
              val secondary: String,
              val isSelected: Boolean,
              val isRadio: Boolean = true
          )
          EOF

      - name: Write TrackAdapter.kt
        run: |
          cat > CheckboxDemo/app/src/main/java/com/checkboxdemo/TrackAdapter.kt << 'EOF'
          package com.checkboxdemo

          import android.view.LayoutInflater
          import android.view.View
          import android.view.ViewGroup
          import android.widget.CheckBox
          import android.widget.RadioButton
          import android.widget.TextView
          import androidx.recyclerview.widget.RecyclerView

          class TrackAdapter(
              private val onSelect: (Int) -> Unit
          ) : RecyclerView.Adapter<TrackAdapter.VH>() {

              private val items = mutableListOf<TrackItem>()

              fun submit(list: List<TrackItem>) {
                  items.clear()
                  items.addAll(list)
                  notifyDataSetChanged()
              }

              fun updateSelection(selectedIndex: Int) {
                  items.forEachIndexed { i, item ->
                      val newSelected = i == selectedIndex
                      if (item.isSelected != newSelected) {
                          items[i] = item.copy(isSelected = newSelected)
                          notifyItemChanged(i)
                      }
                  }
              }

              fun toggleCheckbox(selectedIndex: Int) {
                  val item = items[selectedIndex]
                  items[selectedIndex] = item.copy(isSelected = !item.isSelected)
                  notifyItemChanged(selectedIndex)
              }

              inner class VH(view: View) : RecyclerView.ViewHolder(view) {
                  private val tvPrimary: TextView = view.findViewById(R.id.tvPrimary)
                  private val tvSecondary: TextView = view.findViewById(R.id.tvSecondary)
                  private val radioToggle: RadioButton = view.findViewById(R.id.radioToggle)
                  private val checkToggle: CheckBox = view.findViewById(R.id.checkToggle)

                  init {
                      view.setOnClickListener { onSelect(adapterPosition) }
                  }

                  fun bind(item: TrackItem) {
                      tvPrimary.text = item.primary
                      if (item.secondary.isEmpty()) {
                          tvSecondary.visibility = View.GONE
                      } else {
                          tvSecondary.visibility = View.VISIBLE
                          tvSecondary.text = item.secondary
                      }

                      if (item.isRadio) {
                          radioToggle.visibility = View.VISIBLE
                          checkToggle.visibility = View.GONE
                          radioToggle.isChecked = item.isSelected
                      } else {
                          radioToggle.visibility = View.GONE
                          checkToggle.visibility = View.VISIBLE
                          checkToggle.isChecked = item.isSelected
                      }
                  }
              }

              override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): VH {
                  val view = LayoutInflater.from(parent.context)
                      .inflate(R.layout.item_track_option, parent, false)
                  return VH(view)
              }

              override fun onBindViewHolder(holder: VH, position: Int) = holder.bind(items[position])
              override fun getItemCount() = items.size
          }
          EOF

      - name: Write MockData.kt
        run: |
          cat > CheckboxDemo/app/src/main/java/com/checkboxdemo/MockData.kt << 'EOF'
          package com.checkboxdemo

          object MockData {

              val videoTracks = listOf(
                  TrackItem("Auto",               "",                   isSelected = true,  isRadio = true),
                  TrackItem("None",               "",                   isSelected = false, isRadio = true),
                  TrackItem("3840 × 2160",        "15.20 Mbps",         isSelected = false, isRadio = true),
                  TrackItem("1920 × 1080",        "8.50 Mbps",          isSelected = false, isRadio = true),
                  TrackItem("1280 × 720",         "4.80 Mbps",          isSelected = false, isRadio = true),
                  TrackItem("854 × 480",          "2.10 Mbps",          isSelected = false, isRadio = true),
                  TrackItem("640 × 360",          "0.90 Mbps",          isSelected = false, isRadio = true),
                  TrackItem("426 × 240",          "0.40 Mbps",          isSelected = false, isRadio = true)
              )

              val audioTracks = listOf(
                  TrackItem("Auto",               "Automatic audio",    isSelected = true,  isRadio = true),
                  TrackItem("None",               "No audio",           isSelected = false, isRadio = true),
                  TrackItem("English • Stereo",   "192 kbps",           isSelected = false, isRadio = true),
                  TrackItem("English • Surround 5.1", "384 kbps",       isSelected = false, isRadio = true),
                  TrackItem("Spanish • Stereo",   "128 kbps",           isSelected = false, isRadio = true),
                  TrackItem("French • Mono",      "96 kbps",            isSelected = false, isRadio = true)
              )

              val subtitleTracks = listOf(
                  TrackItem("Auto",               "Automatic subtitles",isSelected = true,  isRadio = true),
                  TrackItem("None",               "No subtitles",       isSelected = false, isRadio = true),
                  TrackItem("English",            "Subtitles",          isSelected = false, isRadio = true),
                  TrackItem("Spanish",            "Subtitles",          isSelected = false, isRadio = true),
                  TrackItem("French",             "Subtitles",          isSelected = false, isRadio = true)
              )

              val speedTracks = listOf(
                  TrackItem("0.25x",              "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("0.5x",               "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("0.75x",              "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("1.0x",               "Playback speed",     isSelected = true,  isRadio = true),
                  TrackItem("1.25x",              "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("1.5x",               "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("1.75x",              "Playback speed",     isSelected = false, isRadio = true),
                  TrackItem("2.0x",               "Playback speed",     isSelected = false, isRadio = true)
              )
          }
          EOF

      - name: Write VideoSettingsDialog.kt
        run: |
          cat > CheckboxDemo/app/src/main/java/com/checkboxdemo/VideoSettingsDialog.kt << 'EOF'
          package com.checkboxdemo

          import android.content.Context
          import android.os.Bundle
          import android.view.ViewGroup
          import android.view.Window
          import android.widget.ImageButton
          import android.widget.Toast
          import androidx.appcompat.app.AppCompatDialog
          import androidx.recyclerview.widget.LinearLayoutManager
          import androidx.recyclerview.widget.RecyclerView
          import com.google.android.material.button.MaterialButton
          import com.google.android.material.tabs.TabLayout

          class VideoSettingsDialog(context: Context) : AppCompatDialog(context) {

              private lateinit var recyclerView: RecyclerView
              private lateinit var tabLayout: TabLayout
              private lateinit var adapter: TrackAdapter

              private val videoItems  = MockData.videoTracks.toMutableList()
              private val audioItems  = MockData.audioTracks.toMutableList()
              private val subtitleItems = MockData.subtitleTracks.toMutableList()
              private val speedItems  = MockData.speedTracks.toMutableList()

              override fun onCreate(savedInstanceState: Bundle?) {
                  super.onCreate(savedInstanceState)
                  requestWindowFeature(Window.FEATURE_NO_TITLE)
                  setContentView(R.layout.dialog_player_settings)

                  val dm = context.resources.displayMetrics
                  val width = (dm.widthPixels * 0.85).toInt()
                  window?.setLayout(width, ViewGroup.LayoutParams.WRAP_CONTENT)
                  window?.setBackgroundDrawableResource(android.R.color.transparent)

                  recyclerView = findViewById(R.id.recyclerView)!!
                  tabLayout    = findViewById(R.id.tabLayout)!!
                  val btnClose  = findViewById<ImageButton>(R.id.btnClose)!!
                  val btnCancel = findViewById<MaterialButton>(R.id.btnCancel)!!
                  val btnApply  = findViewById<MaterialButton>(R.id.btnApply)!!

                  btnClose.setOnClickListener  { dismiss() }
                  btnCancel.setOnClickListener { dismiss() }
                  btnApply.setOnClickListener  {
                      Toast.makeText(context, "Settings applied!", Toast.LENGTH_SHORT).show()
                      dismiss()
                  }

                  recyclerView.layoutManager = LinearLayoutManager(context)
                  adapter = TrackAdapter { index -> onItemSelected(index) }
                  recyclerView.adapter = adapter

                  // Build tabs
                  val tabs = listOf("Video", "Audio", "Subtitles", "Speed")
                  tabs.forEach { tabLayout.addTab(tabLayout.newTab().setText(it)) }

                  tabLayout.addOnTabSelectedListener(object : TabLayout.OnTabSelectedListener {
                      override fun onTabSelected(tab: TabLayout.Tab?) {
                          when (tab?.position) {
                              0 -> showVideo()
                              1 -> showAudio()
                              2 -> showSubtitles()
                              3 -> showSpeed()
                          }
                      }
                      override fun onTabUnselected(tab: TabLayout.Tab?) {}
                      override fun onTabReselected(tab: TabLayout.Tab?) {}
                  })

                  // Show Video tab by default
                  showVideo()
              }

              private var currentTab = 0

              private fun onItemSelected(index: Int) {
                  when (currentTab) {
                      0 -> { adapter.updateSelection(index); videoItems.forEachIndexed { i, item -> if (i != index && videoItems[i].isSelected) { /* reset */ } } }
                      1 -> adapter.updateSelection(index)
                      2 -> adapter.updateSelection(index)
                      3 -> adapter.updateSelection(index)
                  }
              }

              private fun showVideo() {
                  currentTab = 0
                  adapter.submit(videoItems)
              }

              private fun showAudio() {
                  currentTab = 1
                  adapter.submit(audioItems)
              }

              private fun showSubtitles() {
                  currentTab = 2
                  adapter.submit(subtitleItems)
              }

              private fun showSpeed() {
                  currentTab = 3
                  adapter.submit(speedItems)
              }
          }
          EOF

      - name: Write MainActivity.kt
        run: |
          cat > CheckboxDemo/app/src/main/java/com/checkboxdemo/MainActivity.kt << 'EOF'
          package com.checkboxdemo

          import android.os.Bundle
          import androidx.appcompat.app.AppCompatActivity
          import com.checkboxdemo.databinding.ActivityMainBinding

          class MainActivity : AppCompatActivity() {

              private lateinit var binding: ActivityMainBinding

              override fun onCreate(savedInstanceState: Bundle?) {
                  super.onCreate(savedInstanceState)
                  binding = ActivityMainBinding.inflate(layoutInflater)
                  setContentView(binding.root)

                  binding.btnOpenDialog.setOnClickListener {
                      VideoSettingsDialog(this).show()
                  }
              }
          }
          EOF

      - name: Write gradle-wrapper.properties
        run: |
          cat > CheckboxDemo/gradle/wrapper/gradle-wrapper.properties << 'EOF'
          distributionBase=GRADLE_USER_HOME
          distributionPath=wrapper/dists
          distributionUrl=https\://services.gradle.org/distributions/gradle-8.6-bin.zip
          networkTimeout=10000
          validateDistributionUrl=true
          zipStoreBase=GRADLE_USER_HOME
          zipStorePath=wrapper/dists
          EOF

      - name: Download Gradle wrapper jar
        run: |
          curl -sL "https://github.com/gradle/gradle/raw/v8.6.0/gradle/wrapper/gradle-wrapper.jar" \
            -o CheckboxDemo/gradle/wrapper/gradle-wrapper.jar

      - name: Write gradlew script
        run: |
          cat > CheckboxDemo/gradlew << 'EOF'
          #!/usr/bin/env sh
          APP_HOME=$(cd "$(dirname "$0")" && pwd)
          CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar
          if [ -n "$JAVA_HOME" ]; then
            JAVACMD="$JAVA_HOME/bin/java"
          else
            JAVACMD="java"
          fi
          exec "$JAVACMD" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
          EOF
          chmod +x CheckboxDemo/gradlew

      - name: Build debug APK
        working-directory: CheckboxDemo
        run: ./gradlew assembleDebug --stacktrace --no-daemon

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: CheckboxDemo-debug
          path: CheckboxDemo/app/build/outputs/apk/debug/app-debug.apk
          retention-days: 30
